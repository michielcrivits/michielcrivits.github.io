<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<title>Wannes Crivits - Haute Route Pyrenees FKT attempt</title>
		<style type="text/css">
			v\:* {
				behavior:url(#default#VML);
			}
		</style>

		<!-- Make the document body take up the full screen -->
		<style type="text/css">
			html, body {width: 100%; height: 100%}
			body {margin-top: 0px; margin-right: 0px; margin-left: 0px; margin-bottom: 0px}
		</style>

		
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="loadgpx.js" type="text/javascript"></script>
		<script type="text/javascript">

		//<![CDATA[

		var MyMap;
        var locations = [];

		function LoadGPXFileIntoGoogleMap(map, filename)
		{
			var request = new XMLHttpRequest();
			request.open("GET", filename, true);
			request.onreadystatechange = function()
			{
				if (request.readyState == 4)
				{
					parser = new GPXParser(request.responseXML, map);
					parser.setTrackColour("#ff0000");					// Set the track line colour
					parser.setTrackWidth(3);							// Set the track line width
					parser.setMinTrackPointDelta(0.001);				// Set the minimum distance between track points
					parser.centerAndZoom(request.responseXML);			// Center and Zoom the map over all the points.
					parser.addTrackpointsToMap();						// Add the trackpoints
					parser.addWaypointsToMap();							// Add the waypoints
				}
			}
			request.send(null);
		}

                
        function addMarkers() {

        // Load data from an example Google spreadsheet that contains latitude and longitude columns using Google Sheets API v4 that returns JSON.
        // Replace the ID of your Google spreadsheet and you API key in the URL:
        // https://sheets.googleapis.com/v4/spreadsheets/ID_OF_YOUR_GOOGLE_SPREADSHEET/values/Sheet1!A2:Q?key=YOUR_API_KEY
        // Also make sure your API key is authorised to access Google Sheets API - you can enable that through your Google Developer console.
        // Finally, in the URL, fix the sheet name and the range that you are accessing from your spreadsheet. 'Sheet1' is the default name for the first sheet.
        $.getJSON("https://sheets.googleapis.com/v4/spreadsheets/17Qc_MMVV5NTWGC_io--JBPWmEPplBZQOdrlt3sx177A/values/Overview!A5:K7?key=AIzaSyCevCgtTXxREUE-dilAREbSL6_6TmCSpAQ", function(data) {
            // data.values contains the array of rows from the spreadsheet. Each row is also an array of cell values.
            // Modify the code below to suit the structure of your spreadsheet.
            $(data.values).each(function() {
                var location = {};
                    location.runner = this[0];
                    location.startdatetime = this[2];
                    location.startdatetimeOriginal = this[1];
                    location.enddatetimeOriginal = this[3];
                    location.timestamp = this[5];
                    location.timestampOriginal = this[6];
                    location.latitude = parseFloat(this[7]);
                    location.longitude = parseFloat(this[8]);
                    location.fkt = this[9];
                    location.currentAttempt = this[10];
                    locations.push(location);
            });


            setLocations(MyMap, locations);
        });
        }


        function setLocations(map, locations) {
        var bounds = new google.maps.LatLngBounds();
        // Create nice, customised pop-up boxes, to appear when the marker is clicked on
        var infowindow = new google.maps.InfoWindow({
        content: "Content String"
        });
        for (var i = 0; i < locations.length; i++) {
        var new_marker = createMarker(map, locations[i], infowindow);
        bounds.extend(new_marker.position);
        }
        //map.fitBounds(bounds); // zoom to latest marker
        }

        function createMarker(map, location, infowindow) {

        // Modify the code below to suit the structure of your spreadsheet (stored in variable 'location')
        var position = {
        lat: parseFloat(location.latitude),
        lng: parseFloat(location.longitude)
        };
        var marker = new google.maps.Marker({
        position: position,
        map: map,
        title: location.runner,
        });
        google.maps.event.addListener(marker, 'click', function() {
        var content = '<div>'+ '<h2>' + location.runner + '</h2>';
        if (location.currentAttempt == "1"){
            content += '<h3>FKT attempt</h3>' +
            '<p>Startdate: ' + location.startdatetime + '<br />' +
                'Latest trackpoint: ' + location.timestamp + '</p>' 
        }
        if (location.currentAttempt != "1"){
            // compared to current attempt
            content += '<h3>Compared to current attempt</h3>' +
            '<p>Startdate: ' + location.startdatetime + '<br />' +
                'Latest trackpoint: ' + location.timestamp + '</p>' 

            // previous attempt
            content += '<h3>Original attempt</h3>' +
            '<p>Startdate: ' + location.startdatetimeOriginal + '<br />' +
                'Enddate: ' + location.enddatetimeOriginal + '</p>' +

                '<p><b>FKT: ' + location.fkt + '</b></p>'
            '</div>';
        }
        infowindow.setContent(content);
        infowindow.open(map, marker);
        });
        return marker;
        }



		function initialiseMap()
		{
			MyMap = new google.maps.Map(document.getElementById("map"), {
          		center: {lat: 43.373058	, lng: -1.773991},
          		zoom: 10
			});

			LoadGPXFileIntoGoogleMap(MyMap, "HRP.gpx.xml");

            addMarkers();
		}

		//]]>

        
		</script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCevCgtTXxREUE-dilAREbSL6_6TmCSpAQ&callback=initialiseMap" type="text/javascript"></script>
	</head>
	<body >
        <h1>Wannes Crivits - Haute Route Pyrenees - FKT attempt</h1>
        Official website: https://fastestknowntime.com/route/haute-route-pyrenees-spain-andorra-france
		<div id="map" style="width: 100%; height: 100%;"></div>
	</body>
</html>
